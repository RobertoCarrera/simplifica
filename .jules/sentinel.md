## 2025-01-20 - HTML Injection in Search Highlighting
**Vulnerability:** The `AdvancedSearchService` highlighted matches by simple regex replacement, returning unescaped HTML strings. When bound to `[innerHTML]` in Angular components, this allowed HTML injection if the search input contained valid HTML tags (like `<h1>`, `<b>`), potentially breaking layout or injecting unwanted formatting, although Angular's sanitizer mitigated XSS.
**Learning:** Even when using Angular's sanitization, "HTML Injection" (content spoofing) is possible if we treat user input as trusted HTML. When the intent is to display text with highlighting, we must explicitly escape the text content *before* inserting highlighting tags.
**Prevention:** Use a "split-escape-join" pattern when highlighting matches in text. Split the string by the match, escape the non-matching parts (and matching parts), and then wrap matches in `<mark>`. Never return a string containing user input mixed with HTML tags without escaping the user input first.
