<div class="customers-container container">
      
    @if (devRoleService.canSeeDevTools()) {
      <app-dev-user-selector></app-dev-user-selector>
    }
      
      <!-- Header -->
      <div class="header-section row">
        <div class="header-content col-12">
          <div class="title-section row">
            <h1 class="page-title col-12">Gestión de Clientes</h1>
            <p class="page-subtitle col-8">Administra toda la información de tus clientes</p>
          </div>
          
          <!-- Actions -->
          <div class="header-actions row">
            <!-- GDPR Toggle Button -->
            @if (devRoleService.canSeeDevTools()) {
            <button
              (click)="goToGdpr()"
              class="btn"
              [class.btn-primary]="!gdprPanelVisible()"
              [class.btn-secondary]="gdprPanelVisible()"
              title="Mostrar/Ocultar panel GDPR"
            >
              <i class="fas fa-shield-alt"></i>
              GDPR
            </button>      }      
            <button
              (click)="exportCustomers()"
              class="btn btn-secondary col-4"
              [disabled]="isLoading()"
            >
              <i class="fas fa-download"></i>
              Exportar
            </button>
            
            <input
              #fileInput
              type="file"
              accept=".csv"
              (change)="onCsvFileSelected($event)"
              class="hidden"
            >
            <button
              (click)="fileInput.click()"
              class="btn btn-secondary"
              [disabled]="isLoading()"
              title="Importar clientes desde CSV"
            >
              <i class="fas fa-upload"></i>
              Importar CSV
              <i class="fas fa-info-circle info-icon" (click)="showImportInfo($event)"></i>
            </button>
            <div class="search-input-container">
              <i class="fas fa-search search-icon"></i>
              <input
                type="text"
                [(ngModel)]="searchTerm"
                (ngModelChange)="onSearchChange($event)"
                placeholder="Buscar clientes por nombre, email o DNI..."
                class="search-input-full"
              >
            </div>
          </div>
        </div>
      </div>

      <!-- GDPR Panel (Collapsible) -->
      @if (devRoleService.canSeeDevTools() && gdprPanelVisible()) {
        <div class="gdpr-panel mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <i class="fas fa-shield-alt text-blue-600 text-xl mr-2"></i>
              <h3 class="text-lg font-semibold text-blue-900">Panel de Cumplimiento RGPD</h3>
            </div>
            <button
              (click)="toggleGdprPanel()"
              class="btn btn-sm btn-outline"
            >
              <i class="fas fa-times"></i>
              Cerrar
            </button>
          </div>
          
          @if (complianceStats()) {
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
              <div class="bg-white rounded-lg p-3 border border-blue-200">
                <div class="flex items-center">
                  <i class="fas fa-file-alt text-blue-600 text-lg mr-2"></i>
                  <div>
                    <div class="text-lg font-bold text-blue-900">{{ complianceStats()?.accessRequestsCount || 0 }}</div>
                    <div class="text-xs text-blue-600">Solicitudes RGPD</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white rounded-lg p-3 border border-green-200">
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-600 text-lg mr-2"></i>
                  <div>
                    <div class="text-lg font-bold text-green-900">{{ complianceStats()?.activeConsentsCount || 0 }}</div>
                    <div class="text-xs text-green-600">Consentimientos Activos</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white rounded-lg p-3 border border-yellow-200">
                <div class="flex items-center">
                  <i class="fas fa-clock text-yellow-600 text-lg mr-2"></i>
                  <div>
                    <div class="text-lg font-bold text-yellow-900">{{ complianceStats()?.pendingRequestsCount || 0 }}</div>
                    <div class="text-xs text-yellow-600">Solicitudes Pendientes</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white rounded-lg p-3 border border-red-200">
                <div class="flex items-center">
                  <i class="fas fa-exclamation-triangle text-red-600 text-lg mr-2"></i>
                  <div>
                    <div class="text-lg font-bold text-red-900">{{ complianceStats()?.overdueRequestsCount || 0 }}</div>
                    <div class="text-xs text-red-600">Solicitudes Vencidas</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- GDPR Quick Actions -->
            <div class="flex flex-wrap gap-2">
              <button
                (click)="exportComplianceReport()"
                class="btn btn-sm btn-outline"
              >
                <i class="fas fa-file-export mr-1"></i>
                Exportar Informe RGPD
              </button>
            </div>
          }
        </div>
      }

      <!-- Stats Cards -->
      @if (stats()) {
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon users">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stats()?.total || 0 }}</div>
              <div class="stat-label">Total Clientes</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon new">
              <i class="fas fa-user-plus"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stats()?.newThisWeek || 0 }}</div>
              <div class="stat-label">Nuevos esta Semana</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon active">
              <i class="fas fa-calendar-plus"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stats()?.newThisMonth || 0 }}</div>
              <div class="stat-label">Nuevos este Mes</div>
            </div>
          </div>
        </div>
      }

      <!-- Loading State -->
      @if (isLoading() && !customers().length) {
        <div class="loading-section">
          <app-skeleton type="list" [count]="6"></app-skeleton>
        </div>
      }

      <!-- Customers Grid -->
      @if (!isLoading() || customers().length) {
        <div class="customers-grid">
          @for (customer of filteredCustomers(); track customer.id; let i = $index) {
            <div class="customer-card-container" [class.flipped]="flippedCardId() === customer.id">
              
              <!-- Card Inner (for 3D flip) -->
              <div class="customer-card-inner">
                
                <!-- FRONT FACE - Customer Info -->
                <div class="customer-card customer-card-front">
                  
                  <!-- Avatar -->
                  <div class="customer-avatar" (click)="selectCustomer(customer)">
                    @if (customer.avatar_url) {
                      <img 
                        [src]="customer.avatar_url"
                        [alt]="customer.name + ' ' + customer.apellidos"
                        class="avatar-img"
                      >
                    } @else {
                      <div class="avatar-placeholder">
                        {{ getCustomerInitials(customer) }}
                      </div>
                    }
                    
                    <!-- Status Badge -->
                    <div 
                      class="status-badge"
                      [class.active]="customer.activo"
                      [class.inactive]="!customer.activo"
                      [title]="customer.activo ? 'Cliente activo' : 'Cliente inactivo'"
                    ></div>
                  </div>

                  <!-- Customer Info -->
                  <div class="customer-info">
                <h3 class="customer-name">
                  {{ customer.name }} {{ customer.apellidos }}
                </h3>

                <!-- Incomplete/Needs Attention Chip -->
                @if (customer?.metadata?.needs_attention || customer?.metadata?.inactive_on_import) {
                  <div class="mb-2">
                    <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700 border border-red-200" [title]="formatAttentionReasons(customer)">
                      <i class="fas fa-exclamation-circle mr-1"></i>
                      Incompleto
                    </span>
                  </div>
                }
                
                <!-- GDPR Status Indicator -->
                <div class="gdpr-status mb-2">
                  <span 
                    class="text-xs px-2 py-1 rounded-full {{ getGdprStatusClass(customer) }}"
                    [title]="getGdprStatusText(customer)"
                  >
                    <i class="fas fa-shield-alt mr-1"></i>
                    {{ getGdprStatusText(customer) }}
                  </span>
                  @if (getGdprComplianceStatus(customer) === 'pending' && customer.email) {
                    <button
                      class="ml-2 inline-flex items-center text-xs px-2 py-1 rounded border border-blue-300 text-blue-700 hover:bg-blue-50"
                      title="Obtener enlace de consentimiento (copiar al portapapeles)"
                      (click)="sendConsentRequest(customer); $event.stopPropagation()"
                    >
                      <i class="fas fa-link mr-1"></i>
                      Obtener enlace
                    </button>
                  }
                </div>
                
                <div class="customer-details">
                  <div class="detail-item">
                    <i class="fas fa-envelope detail-icon"></i>
                    <span class="detail-text">{{ customer.email }}</span>
                  </div>
                  
                  @if (customer.phone) {
                    <div class="detail-item">
                      <i class="fas fa-phone detail-icon"></i>
                      <span class="detail-text">{{ customer.phone }}</span>
                    </div>
                  }
                  
                  @if (customer.dni) {
                    <div class="detail-item">
                      <i class="fas fa-id-card detail-icon"></i>
                      <span class="detail-text">{{ customer.dni }}</span>
                    </div>
                  }
                  
                  <div class="detail-item">
                    <i class="fas fa-calendar detail-icon"></i>
                    <span class="detail-text">{{ formatDate(customer.created_at) }}</span>
                  </div>
                  
                  <!-- GDPR Data Protection Info -->
                  @if (customer.data_retention_until) {
                    <div class="detail-item">
                      <i class="fas fa-hourglass detail-icon"></i>
                      <span class="detail-text text-xs">Retención hasta: {{ formatDate(customer.data_retention_until) }}</span>
                    </div>
                  }
                  
                  @if (customer.is_minor) {
                    <div class="detail-item">
                      <i class="fas fa-child detail-icon text-orange-600"></i>
                      <span class="detail-text text-xs text-orange-600">Menor de edad - Consentimiento parental requerido</span>
                    </div>
                  }
                </div>

                
              </div>

                  <!-- Actions -->
                  <div class="customer-actions">
                    
                    <button
                      (click)="editCustomer(customer); $event.stopPropagation()"
                      class="action-btn edit"
                      title="Editar cliente"
                    >
                      <i class="fas fa-edit"></i>
                    </button>
                    
                    <!-- GDPR Flip Button -->
                    <button
                      (click)="flipCardToGdpr($event, customer.id)"
                      class="action-btn gdpr"
                      [class.opacity-50]="customer?.metadata?.inactive_on_import"
                      [disabled]="customer?.metadata?.inactive_on_import"
                      title="Acciones RGPD"
                    >
                      <i class="fas fa-shield-alt"></i>
                    </button>
                    
                    <button
                      (click)="deleteCustomer(customer); $event.stopPropagation()"
                      class="action-btn delete"
                      [class.opacity-50]="customer?.metadata?.inactive_on_import"
                      [disabled]="customer?.metadata?.inactive_on_import"
                      title="Eliminar cliente"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
                
                <!-- BACK FACE - GDPR Menu -->
                <div class="customer-card customer-card-back">
                  
                  <!-- Close Button -->
                  <button
                    (click)="closeGdprCard($event)"
                    class="gdpr-close-btn"
                    title="Cerrar"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                  
                  <!-- GDPR Header -->
                  <div class="gdpr-back-header">
                    <div class="gdpr-back-icon">
                      <i class="fas fa-shield-alt"></i>
                    </div>
                    <div>
                      <h3 class="gdpr-back-title">Acciones RGPD</h3>
                      <p class="gdpr-back-subtitle">{{ customer.name }} {{ customer.apellidos }}</p>
                    </div>
                  </div>
                  
                  <!-- GDPR Actions -->
                  <div class="gdpr-back-actions">
                    
                    <button
                      (click)="sendConsentRequest(customer); $event.stopPropagation()"
                      class="gdpr-back-btn"
                    >
                      <i class="fas fa-envelope-open-text"></i>
                      <span>Solicitar Consentimiento</span>
                    </button>

                    <button
                      (click)="requestDataAccess(customer); $event.stopPropagation()"
                      class="gdpr-back-btn"
                    >
                      <i class="fas fa-file-alt"></i>
                      <span>Solicitar Acceso Datos</span>
                    </button>
                    
                    <button
                      (click)="exportCustomerData(customer); $event.stopPropagation()"
                      class="gdpr-back-btn"
                    >
                      <i class="fas fa-download"></i>
                      <span>Exportar Datos RGPD</span>
                    </button>
                    
                    <div class="gdpr-back-divider"></div>
                    
                    <button
                      (click)="openGdprModal(customer); $event.stopPropagation()"
                      class="gdpr-back-btn primary"
                    >
                      <i class="fas fa-cog"></i>
                      <span>Gestionar GDPR Completo</span>
                    </button>
                    
                    <button
                      (click)="anonymizeCustomer(customer); $event.stopPropagation()"
                      class="gdpr-back-btn danger"
                      [disabled]="isCustomerAnonymized(customer)"
                      [class.opacity-50]="isCustomerAnonymized(customer)"
                      [title]="isCustomerAnonymized(customer) ? 'Cliente ya anonimizado' : 'Anonimizar datos del cliente (irreversible)'"
                    >
                      <i class="fas fa-user-slash"></i>
                      <span>{{ isCustomerAnonymized(customer) ? 'Ya Anonimizado' : 'Derecho al Olvido' }}</span>
                    </button>
                    
                  </div>
                </div>
                
              </div>
            </div>
          }
        </div>
      }

      <!-- Empty State -->
      @if (!isLoading() && !customers().length) {
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-users"></i>
          </div>
          <h3 class="empty-title">No hay clientes todavía</h3>
          <p class="empty-message">Comienza creando tu primer cliente</p>
          <button
            (click)="openForm()"
            class="btn btn-primary"
          >
            <i class="fas fa-plus"></i>
            Crear Primer Cliente
          </button>
        </div>
      }

      <!-- No Results -->
      @if (!isLoading() && customers().length && !filteredCustomers().length) {
        <div class="no-results">
          <div class="no-results-icon">
            <i class="fas fa-search"></i>
          </div>
          <h3 class="no-results-title">No se encontraron clientes</h3>
          <p class="no-results-message">Intenta con otros términos de búsqueda</p>
          <button
            (click)="clearFilters()"
            class="btn btn-secondary"
          >
            <i class="fas fa-times"></i>
            Limpiar Filtros
          </button>
        </div>
      }

      <!-- Loading Overlay -->
      @if (isLoading() && customers().length) {
        <div class="loading-overlay">
          <app-loading
            type="spinner"
            size="lg"
            text="Actualizando clientes..."
            [overlay]="true"
          ></app-loading>
        </div>
      }
    </div>

    <!-- Customer Form Modal -->
    @if (showForm()) {
      <div class="modal-overlay">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas" [class.fa-plus]="!selectedCustomer()" [class.fa-edit]="selectedCustomer()"></i>
              {{ selectedCustomer() ? 'Editar Cliente' : 'Nuevo Cliente' }}
            </h2>
            <button (click)="closeForm()" class="modal-close">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <!-- Customer Form -->
          <div class="modal-body">
            <form (ngSubmit)="saveCustomer()" #customerForm="ngForm" class="customer-form">
              
              <div class="form-row">
                <div class="form-group">
                  <label for="nombre" class="form-label">
                    <i class="fas fa-user"></i>
                    Nombre *
                  </label>
                  <input
                    type="text"
                    id="nombre"
                    name="nombre"
                    [(ngModel)]="formData.name"
                    required
                    class="form-input"
                    placeholder="Introduce el nombre"
                  >
                </div>
                
                <div class="form-group">
                  <label for="apellidos" class="form-label">
                    <i class="fas fa-user"></i>
                    Apellidos *
                  </label>
                  <input
                    type="text"
                    id="apellidos"
                    name="apellidos"
                    [(ngModel)]="formData.apellidos"
                    required
                    class="form-input"
                    placeholder="Introduce los apellidos"
                  >
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="email" class="form-label">
                    <i class="fas fa-envelope"></i>
                    Email *
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    [(ngModel)]="formData.email"
                    required
                    class="form-input"
                    placeholder="correo@ejemplo.com"
                  >
                </div>
                
                <div class="form-group">
                  <label for="telefono" class="form-label">
                    <i class="fas fa-phone"></i>
                    Teléfono
                  </label>
                  <input
                    type="tel"
                    id="telefono"
                    name="telefono"
                    [(ngModel)]="formData.phone"
                    class="form-input"
                    placeholder="666 123 456"
                  >
                </div>
              </div>

              <div class="form-group">
                <label for="dni" class="form-label">
                  <i class="fas fa-id-card"></i>
                  DNI/NIF
                </label>
                <input
                  type="text"
                  id="dni"
                  name="dni"
                  [(ngModel)]="formData.dni"
                  class="form-input"
                  placeholder="12345678Z"
                >

                <!-- Honeypot field - hidden from users, detects bots -->
                <input
                  type="text"
                  [(ngModel)]="formData.honeypot"
                  [name]="honeypotFieldName"
                  style="position:absolute;left:-9999px;width:0;height:0;opacity:0;pointer-events:none;"
                  tabindex="-1"
                  autocomplete="off"
                  aria-hidden="true"
                  [attr.data-honeypot]="true"
                >
              </div>

              <!-- Responsive address row: desktop -> four columns; mobile -> stacked -->
              <div class="form-row grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="form-group relative">
                  <label for="addressTipoVia" class="form-label">Tipo Vía</label>
                  <input id="addressTipoVia" name="addressTipoVia" [(ngModel)]="formData.addressTipoVia" (input)="onAddressViaInput($event)" class="form-input" placeholder="Escribe para buscar tipo vía">
                  <div class="category-input-container">
                    <div *ngIf="viaDropdownOpen" class="category-dropdown">
                      <div class="category-options">
                        <div *ngFor="let via of filteredVias" class="category-option" (click)="formData.addressTipoVia = via; filteredVias = []">
                          <span>{{ via }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="addressNombre" class="form-label">Nombre Calle</label>
                  <input type="text" id="addressNombre" name="addressNombre" [(ngModel)]="formData.addressNombre" class="form-input" placeholder="Calle, Avenida...">
                </div>

                <div class="form-group">
                  <label for="addressNumero" class="form-label">Número</label>
                  <input type="text" id="addressNumero" name="addressNumero" [(ngModel)]="formData.addressNumero" class="form-input" placeholder="Número">
                </div>

                <div class="form-group relative">
                  <label for="addressLocalidadId" class="form-label">Localidad</label>
                  <input id="addressLocalidadId" name="addressLocalidadId" [(ngModel)]="addressLocalityName" (input)="onLocalityInput($event)" class="form-input" placeholder="Buscar por nombre o código postal">
                  <div class="category-input-container">
                    <div *ngIf="localityDropdownOpen" class="category-dropdown">
                      <div class="category-options">
                        <div *ngFor="let loc of filteredLocalities" class="category-option" (click)="selectLocality(loc)">
                          <span>{{ loc.nombre }} - {{ loc.provincia }} (CP: {{ loc.CP }})</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="addressLocalityName" class="mt-2">
                    <button type="button" class="btn btn-sm btn-outline" (click)="openCreateLocality()">
                      <i class="fas fa-plus mr-1"></i> Crear nueva localidad
                    </button>
                  </div>
                </div>

                <!-- create-locality modal moved below the form to avoid nested form/ngModel issues -->
              </div>
              
            </form>

            <!-- create-locality modal (moved out of the parent <form> to avoid ngModel inside a form) -->
            <app-modal [visible]="showCreateLocalityModal" (close)="closeCreateLocality()">
              <h3 class="text-lg font-semibold mb-2">Crear nueva localidad</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                  <label class="form-label">Nombre</label>
                  <input #newLocalityNameInput name="newLocalityName" type="text" class="form-input" [(ngModel)]="newLocalityName" (input)="onNewLocalityNameInput($event)" placeholder="Nombre de la localidad">
                  <ul *ngIf="filteredNameSuggestions.length" class="absolute bg-white border rounded mt-1 w-full max-h-40 overflow-auto">
                    <li *ngFor="let s of filteredNameSuggestions" (click)="selectNameSuggestion(s)" class="px-2 py-1 hover:bg-gray-100 cursor-pointer">{{ s }}</li>
                  </ul>
                  <div *ngIf="nameMatchesList.length" class="mt-2 border rounded p-2 bg-gray-50">
                    <div class="text-sm text-gray-600 mb-1">Localidades existentes con ese nombre (elige por CP si corresponde):</div>
                    <ul class="max-h-32 overflow-auto">
                      <li *ngFor="let m of nameMatchesList" (click)="selectExistingFromName(m)" class="px-2 py-1 hover:bg-gray-100 cursor-pointer">{{ m.nombre }} (CP: {{ m.CP }})</li>
                    </ul>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Provincia</label>
                  <input name="newLocalityProvince" type="text" class="form-input" [(ngModel)]="newLocalityProvince" placeholder="Provincia">
                </div>

                <div class="form-group">
                  <label class="form-label">Código Postal</label>
                  <input #newLocalityCPInput name="newLocalityCP" type="text" class="form-input" [(ngModel)]="newLocalityCP" (input)="onNewLocalityCPInput($event)" placeholder="Código Postal">
                </div>

                <div class="form-group">
                  <label class="form-label">País</label>
                  <input name="newLocalityCountry" type="text" class="form-input" [value]="newLocalityCountry || 'España'" placeholder="España" readonly tabindex="-1" aria-readonly="true">
                </div>
              </div>
              <div style="height:12px"></div>
              <div class="modal-actions mt-3 flex justify-end gap-2">
                <button class="btn btn-secondary" type="button" (click)="closeCreateLocality()">Cancelar</button>
                <button class="btn btn-primary" type="button" (click)="createLocalityFromInput()" [disabled]="cpExists">Crear localidad</button>
              </div>
              <div *ngIf="cpExists" class="mt-3 p-3 border-l-4 border-yellow-300 bg-yellow-50 rounded">
                <div class="text-sm">Ya existe una localidad con ese <strong>Código Postal</strong>:</div>
                <div class="mt-1 font-medium">{{ existingLocalityByCP?.nombre }} (CP: {{ existingLocalityByCP?.CP }})</div>
                <div class="mt-2">
                  <button class="btn btn-outline btn-sm mr-2" (click)="selectExistingFromName(existingLocalityByCP!)">Seleccionar esta localidad</button>
                  <button class="btn btn-ghost btn-sm" (click)="closeCreateLocality()">Cancelar</button>
                </div>
              </div>
            </app-modal>
          </div>

          <div class="modal-footer">
            <button type="button" (click)="closeForm()" class="btn btn-secondary">
              <i class="fas fa-times"></i>
              Cancelar
            </button>
            <button 
              type="button" 
              (click)="saveCustomer()"
              class="btn btn-primary"
              [disabled]="!customerForm.form.valid || isLoading()"
            >
              <i class="fas fa-save"></i>
              {{ selectedCustomer() ? 'Actualizar' : 'Crear' }}
            </button>
          </div>
        </div>
      </div>
    }

    <!-- CSV Header Mapper Modal -->
    <app-csv-header-mapper
      [visible]="showCsvMapper()"
      [csvHeaders]="csvHeaders()"
      [csvData]="csvData()"
      [fieldOptions]="customerFieldOptions"
      [requiredFields]="customerRequiredFields"
      [aliasMap]="customerAliasMap"
      (mappingConfirmed)="onCsvMappingConfirmed($event)"
      (cancelled)="onCsvMappingCancelled()"
    ></app-csv-header-mapper>

    <!-- GDPR Management Modal -->
    @if (gdprModalClient()) {
      <app-client-gdpr-modal
        [isOpen]="showGdprModal()"
        [clientId]="gdprModalClient()!.id"
        [clientEmail]="gdprModalClient()!.email"
        [clientName]="gdprModalClient()!.name + ' ' + (gdprModalClient()!.apellidos || '')"
        (closeModal)="closeGdprModal()">
      </app-client-gdpr-modal>
    }

    <!-- Floating Action Button (FAB) -->
    <button
      (click)="openForm()"
      class="fab-button"
      title="Nuevo Cliente"
      [disabled]="isLoading()"
    >
      <i class="fas fa-plus"></i>
    </button>
