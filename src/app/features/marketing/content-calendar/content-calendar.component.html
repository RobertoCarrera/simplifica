<div class="h-full flex flex-col" [class.dark]="themeService.currentTheme() === 'dark'">

    <!-- Header / Actions -->
    <div class="flex justify-between items-center mb-6 px-1">
        <div>
            <h2 class="text-xl font-bold text-slate-800 dark:text-white tracking-tight">Calendario de Contenidos</h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">Organiza tus publicaciones de redes sociales</p>
        </div>
        <button (click)="openPostModal()"
            class="px-5 py-2.5 bg-pink-600 hover:bg-pink-700 text-white rounded-xl text-sm font-medium shadow-lg shadow-pink-200 dark:shadow-none hover:shadow-pink-300 transition-all transform hover:-translate-y-0.5 flex items-center gap-2">
            <i class="fas fa-plus"></i> Nuevo Post
        </button>
    </div>

    <!-- Board Container -->
    <div class="flex-1 overflow-x-auto overflow-y-hidden" cdkDropListGroup>
        <div class="flex h-full gap-6 pb-4 min-w-fit px-2 pt-2">

            @for (col of kanbanColumns; track col.id) {
            <div
                class="flex-shrink-0 w-80 flex flex-col bg-slate-50/50 dark:bg-slate-800/20 rounded-2xl border border-slate-200/50 dark:border-slate-700/30 backdrop-blur-sm transition-all duration-300">

                <!-- Column Header -->
                <div class="p-4 flex justify-between items-center sticky top-0 z-10 rounded-t-2xl">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full shadow-sm ring-2 ring-opacity-50"
                            [ngClass]="getColColor(col.id)"></div>
                        <h3
                            class="font-bold text-sm uppercase text-slate-700 dark:text-slate-200 tracking-wider text-shadow-sm">
                            {{ col.label }}</h3>
                    </div>
                    <span
                        class="text-xs bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2.5 py-1 rounded-full font-bold shadow-sm border border-slate-100 dark:border-slate-600">
                        {{ getPostsByStatus(col.id).length }}
                    </span>
                </div>

                <!-- Drop List -->
                <div cdkDropList [cdkDropListData]="getPostsByStatus(col.id)"
                    class="flex-1 px-3 pb-3 overflow-y-auto space-y-4 scrollbar-hide"
                    (cdkDropListDropped)="drop($event, col.id)">

                    <!-- Post Card -->
                    @for (post of getPostsByStatus(col.id); track post.id) {
                    <div cdkDrag
                        class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] border border-slate-100 dark:border-slate-700 hover:shadow-[0_8px_16px_-4px_rgba(0,0,0,0.1)] hover:border-pink-200 dark:hover:border-pink-800 transition-colors cursor-grab active:cursor-grabbing group relative overflow-hidden">

                        <!-- Decorative gradient accent -->
                        <div
                            class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-transparent via-slate-200 dark:via-slate-700 to-transparent opacity-50">
                        </div>

                        <!-- Card Header: Platform & Date -->
                        <div class="flex justify-between items-center mb-3">
                            <span
                                class="text-[10px] font-bold uppercase tracking-widest px-2.5 py-1 rounded-lg border shadow-sm backdrop-blur-md"
                                [ngClass]="getPlatformBadgeClass(post.platform)">
                                <i [class]="getPlatformIcon(post.platform)" class="mr-1.5 opacity-80"></i>
                                {{ post.platform }}
                            </span>
                            <!-- Options (hover only) -->
                            <!-- <button class="text-slate-300 hover:text-slate-500 opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fas fa-ellipsis-h"></i>
                            </button> -->
                        </div>

                        <!-- Card Title -->
                        <div class="mb-3 pl-2">
                            <h4
                                class="text-base font-bold text-slate-800 dark:text-slate-100 leading-tight group-hover:text-pink-600 dark:group-hover:text-pink-400 transition-colors">
                                {{ post.title }}
                            </h4>
                        </div>

                        <!-- Card Notes -->
                        @if(post.notes) {
                        <div class="mb-4 pl-2">
                            <p class="text-xs text-slate-500 dark:text-slate-400 line-clamp-2 leading-relaxed">
                                {{ post.notes }}
                            </p>
                        </div>
                        }

                        <!-- Card Footer: Schedule -->
                        <div
                            class="flex items-center justify-between pt-3 border-t border-slate-50 dark:border-slate-700/30 mt-1 pl-2">
                            <div class="flex items-center gap-2 text-xs font-medium text-slate-400">
                                <i class="far fa-calendar-alt"></i>
                                {{ post.scheduled_date | date:'d MMM' }}
                            </div>

                            <div class="flex gap-2">
                                <button
                                    class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-50 dark:bg-slate-700 hover:bg-pink-50 dark:hover:bg-pink-900/30 text-slate-400 hover:text-pink-600 dark:hover:text-pink-400 transition-all shadow-sm hover:shadow-md opacity-0 group-hover:opacity-100 duration-200 translate-y-2 group-hover:translate-y-0"
                                    title="Editar">
                                    <i class="fas fa-pencil-alt text-xs"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                    }

                    @if (getPostsByStatus(col.id).length === 0) {
                    <div
                        class="flex flex-col items-center justify-center py-12 text-slate-300 dark:text-slate-600 space-y-2 opacity-50">
                        <i class="far fa-sticky-note text-2xl"></i>
                        <span class="text-xs font-medium">Bandeja vacía</span>
                    </div>
                    }

                </div>
            </div>
            }
        </div>
    </div>

    <!-- Modal: New Post -->
    @if (showPostModal()) {
    <div
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-md animate-fade-in">
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden transform scale-100 transition-all items-center flex flex-col relative border border-white/20">
            <!-- Close Button -->
            <button (click)="showPostModal.set(false)"
                class="absolute top-4 right-4 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-500 dark:text-slate-300 transition-colors">
                <i class="fas fa-times"></i>
            </button>

            <div
                class="w-full px-8 py-6 border-b border-slate-100 dark:border-slate-700 bg-gradient-to-r from-pink-50/50 to-indigo-50/50 dark:from-slate-800 dark:to-slate-800">
                <h3 class="font-bold text-xl text-slate-900 dark:text-white mb-1">Nuevo Contenido</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400">Planifica tu próxima publicación</p>
            </div>

            <form [formGroup]="postForm" (ngSubmit)="savePost()" class="w-full p-8 space-y-5">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Título /
                        Idea</label>
                    <input type="text" formControlName="title" placeholder="Ej: Reel sobre beneficios del pilates"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all placeholder:text-slate-400">
                </div>

                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label
                            class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Plataforma</label>
                        <select formControlName="platform"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all appearance-none cursor-pointer">
                            <option value="instagram">Instagram</option>
                            <option value="tiktok">TikTok</option>
                            <option value="blog">Blog</option>
                            <option value="newsletter">Newsletter</option>
                            <option value="linkedin">LinkedIn</option>
                        </select>
                    </div>
                    <div>
                        <label
                            class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Fecha</label>
                        <input type="date" formControlName="scheduled_date"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Notas /
                        Copy</label>
                    <textarea formControlName="notes" rows="4" placeholder="Escribe aquí el copy, hashtags o ideas..."
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all placeholder:text-slate-400 resize-none"></textarea>
                </div>

                <div class="pt-4">
                    <button type="submit" [disabled]="postForm.invalid"
                        class="w-full py-3.5 bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white font-bold rounded-xl shadow-lg shadow-pink-200 dark:shadow-none transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed">
                        Añadir al Calendario
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

</div>