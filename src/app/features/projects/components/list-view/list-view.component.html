<div class="h-full overflow-auto bg-white dark:bg-gray-900">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0 z-10">
            <tr>
                <th scope="col" (click)="toggleSort('name')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Proyecto
                    <span *ngIf="sortColumn === 'name'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th scope="col" (click)="toggleSort('client')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Cliente
                    <span *ngIf="sortColumn === 'client'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th scope="col" (click)="toggleSort('priority')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Prioridad
                    <span *ngIf="sortColumn === 'priority'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th scope="col" (click)="toggleSort('status')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Estado
                    <span *ngIf="sortColumn === 'status'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th scope="col" (click)="toggleSort('end_date')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Entrega
                    <span *ngIf="sortColumn === 'end_date'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th scope="col" (click)="toggleSort('progress')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none">
                    Progreso
                    <span *ngIf="sortColumn === 'progress'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
            </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800">
            <tr *ngFor="let project of sortedProjects" (click)="projectClick.emit(project)"
                class="hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer transition-colors group">

                <!-- Name & Desc -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex flex-col">
                        <span class="text-sm font-medium text-gray-900 dark:text-white">{{ project.name }}</span>
                        <span class="text-xs text-gray-500 truncate max-w-xs">{{ project.description }}</span>
                    </div>
                </td>

                <!-- Client -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        {{ project.client?.business_name || project.client?.name + ' ' + (project.client?.apellidos ||
                        '') || '-' }}
                    </div>
                </td>

                <!-- Priority -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                        [ngClass]="getPriorityColor(project.priority)">
                        {{ getPriorityLabel(project.priority) }}
                    </span>
                </td>

                <!-- Status -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                    {{ getStageName(project.stage_id) }}
                </td>

                <!-- Due Date -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                    <div class="flex items-center">
                        <svg class="mr-1.5 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        {{ project.end_date ? (project.end_date | date:'mediumDate') : '-' }}
                    </div>
                </td>

                <!-- Progress -->
                <td class="px-6 py-4 whitespace-nowrap align-middle">
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1 max-w-[100px]">
                        <div class="bg-blue-600 h-1.5 rounded-full" [style.width.%]="getProgress(project)"></div>
                    </div>
                    <span class="text-xs text-gray-400 mt-1 inline-block">{{ getProgress(project) }}%</span>
                </td>
            </tr>

            <tr *ngIf="projects.length === 0">
                <td colspan="6" class="px-6 py-10 text-center text-gray-500">
                    No se encontraron proyectos.
                </td>
            </tr>
        </tbody>
    </table>
</div>