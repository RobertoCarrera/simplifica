<div class="widget-container" *ngIf="company()">
    <!-- Header -->
    <header class="widget-header">
        <div class="logo-area" *ngIf="company().logo_url">
            <img [src]="company().logo_url" [alt]="company().name">
        </div>
        <h1>{{ company().name }}</h1>
        <p *ngIf="step() === 'service'">Selecciona un servicio</p>
        <p *ngIf="step() === 'datetime'">Elige fecha y hora</p>
        <p *ngIf="step() === 'details'">Tus datos</p>
    </header>

    <!-- Error -->
    <div class="error-banner" *ngIf="error()">
        {{ error() }}
    </div>

    <!-- Loading -->
    <div class="loading-overlay" *ngIf="loading()">
        <div class="spinner"></div>
    </div>

    <!-- Step 1: Services -->
    <div class="step-content" *ngIf="step() === 'service'">
        <div class="service-list">
            <div class="service-card" *ngFor="let s of services()" (click)="selectService(s)">
                <div class="service-info">
                    <h3>{{ s.name }}</h3>
                    <p class="desc">{{ s.description || 'Sin descripci√≥n' }}</p>
                </div>
                <div class="service-meta">
                    <span class="badgee">{{ s.duration_minutes }} min</span>
                    <span class="price" *ngIf="s.price">{{ s.price | currency:'EUR' }}</span>
                </div>
            </div>
        </div>
        <div *ngIf="services().length === 0 && !loading()" class="empty-state">
            No hay servicios disponibles.
        </div>
    </div>

    <!-- Step 2: Date & Time -->
    <div class="step-content" *ngIf="step() === 'datetime'">
        <button class="btn-back" (click)="back()">‚Üê Volver</button>

        <div class="date-picker-area">
            <label>Fecha:</label>
            <input type="date" [value]="dateInputValue" (change)="onDateInput($event)" [min]="'2024-01-01'">
        </div>

        <div class="slots-grid" *ngIf="availableSlots().length > 0; else noSlots">
            <button *ngFor="let slot of availableSlots()" class="slot-btn" (click)="selectSlot(slot)">
                {{ slot | date:'HH:mm' }}
            </button>
        </div>
        <ng-template #noSlots>
            <p class="empty-state">No hay huecos disponibles para esta fecha.</p>
        </ng-template>
    </div>

    <!-- Step 3: Details -->
    <div class="step-content" *ngIf="step() === 'details'">
        <button class="btn-back" (click)="back()">‚Üê Volver</button>

        <div class="summary-card">
            <h3>{{ selectedService().name }}</h3>
            <p>{{ selectedSlot() | date:'fullDate' }} a las {{ selectedSlot() | date:'shortTime' }}</p>
        </div>

        <form (submit)="submitBooking()">
            <div class="form-group">
                <label>Nombre Completo *</label>
                <input type="text" [(ngModel)]="formData.name" name="name" required placeholder="Tu nombre">
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" [(ngModel)]="formData.email" name="email" required placeholder="tu@email.com">
            </div>
            <div class="form-group">
                <label>Tel√©fono</label>
                <input type="tel" [(ngModel)]="formData.phone" name="phone" placeholder="+34 ...">
            </div>
            <div class="form-group">
                <label>Notas</label>
                <textarea [(ngModel)]="formData.notes" name="notes"
                    placeholder="Alguna petici√≥n especial..."></textarea>
            </div>

            <button type="submit" class="btn-primary" [disabled]="loading()">Confirmar Reserva</button>
        </form>
    </div>

    <!-- Step 4: Success -->
    <div class="step-content success-view" *ngIf="step() === 'success'">
        <div class="success-icon">üéâ</div>
        <h2>¬°Reserva Confirmada!</h2>
        <p>Hemos enviado un email con los detalles a <strong>{{ formData.email }}</strong>.</p>
        <button class="btn-primary"
            (click)="step.set('service'); formData = {name:'', email:'', phone:'', notes:''}">Nueva Reserva</button>
    </div>

</div>

<div class="widget-container" *ngIf="!company() && !loading() && !error()">
    <p>Cargando informaci√≥n...</p>
</div>