<div class="message-detail-container" *ngIf="message() as msg">
    <div class="header">
        <div class="toolbar">
            <button class="btn-icon" routerLink="../.."><i class="fas fa-arrow-left"></i></button>
            <div class="actions">
                <button class="btn-icon" title="Responder" (click)="reply()"><i class="fas fa-reply"></i></button>
                <button class="btn-icon" title="Eliminar"><i class="fas fa-trash"></i></button>
            </div>
        </div>

        <h2 class="subject">{{ msg.subject }}</h2>

        <div class="metadata">
            <div class="avatar">{{ (msg.from.name || msg.from.email).charAt(0).toUpperCase() }}</div>
            <div class="info">
                <div class="sender">
                    <span class="name">{{ msg.from.name }}</span>
                    <span class="email">&lt;{{ msg.from.email }}&gt;</span>
                </div>
                <div class="date">{{ msg.received_at | date:'medium' }}</div>
            </div>
        </div>
    </div>

    <div class="body-content">
        <!-- Using innerHTML carefully (should be sanitized) -->
        <div class="email-body" [innerHTML]="msg.body_html || msg.body_text"></div>
    </div>

    <div *ngIf="msg.attachments?.length" class="attachments">
        <h3>Adjuntos ({{ msg.attachments!.length }})</h3>
        <div class="attachment-list">
            <div *ngFor="let att of msg.attachments" class="attachment-item">
                <i class="fas fa-paperclip"></i>
                <span>{{ att.filename }}</span>
                <span class="size">({{ att.size / 1024 | number:'1.0-0' }} KB)</span>
            </div>
        </div>
    </div>
</div>