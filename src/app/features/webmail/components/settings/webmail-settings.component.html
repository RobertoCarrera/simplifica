<div class="settings-container">
    <div class="settings-header">
        <button class="btn-icon back-btn" (click)="close.emit()" title="Volver">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h3>Configuración</h3>
    </div>



    <div class="scrollable-content">
        <!-- TAB: ACCOUNTS -->
        <div class="tab-pane fade-in" *ngIf="activeTab() === 'accounts'">

            <!-- List Mode -->
            <ng-container *ngIf="!isAdding && !isEditing">
                <div class="section-title">
                    <span>Mis Cuentas</span>
                    <span class="count" *ngIf="accounts().length > 0">{{ accounts().length }}</span>
                </div>

                <div class="card-list">
                    <div *ngFor="let acc of accounts()" class="setting-card">
                        <div class="card-icon account">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="card-info">
                            <div class="primary-text">{{ acc.email }}</div>
                            <div class="secondary-text">{{ acc.sender_name }}</div>
                        </div>
                        <div class="card-actions">
                            <button class="btn-icon edit-btn" (click)="editAccount(acc)" title="Editar configuración">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="btn-icon danger delete-btn" (click)="deleteAccount(acc.id!)"
                                title="Eliminar cuenta">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>

                    <div *ngIf="accounts().length === 0" class="empty-state">
                        <div class="empty-icon"><i class="fas fa-inbox"></i></div>
                        <p>No tienes cuentas configuradas.</p>
                        <small>Añade una cuenta para empezar a enviar correos.</small>
                    </div>
                </div>

                <div class="sticky-fab-container">
                    <button class="btn btn-primary fab-extended" (click)="toggleAdd()">
                        <i class="fas fa-plus"></i> Añadir Cuenta
                    </button>
                </div>
            </ng-container>

            <!-- Add/Edit Mode -->
            <div class="add-form-wrapper scale-in" *ngIf="isAdding || isEditing">
                <div class="form-header">
                    <h4>{{ isEditing ? 'Configurar Cuenta' : 'Nueva Cuenta' }}</h4>
                    <button class="btn-icon close-form" (click)="toggleAdd()"><i class="fas fa-times"></i></button>
                </div>

                <div class="form-body">
                    <!-- Email Section: Different for Edit/Add -->
                    <div class="form-section">
                        <label>Dirección de Correo</label>

                        <div class="email-input-group" *ngIf="isAdding">
                            <input type="text" [(ngModel)]="formModel.prefix" placeholder="usuario"
                                class="form-input prefix">
                            <span class="separator">&#64;</span>
                            <select [(ngModel)]="formModel.domain" class="form-select domain">
                                <option value="" disabled selected>Seleccionar dominio</option>
                                <option *ngFor="let d of myDomains()" [value]="d.domain">{{ d.domain }}</option>
                            </select>
                        </div>

                        <div *ngIf="isEditing">
                            <input type="text" [value]="formModel.email" disabled class="form-input disabled">
                            <small class="hint">El email no se puede cambiar.</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <label>Nombre del Remitente</label>
                        <input type="text" [(ngModel)]="formModel.name" placeholder="Ej: Juan Pérez" class="form-input">
                    </div>

                    <div class="form-section">
                        <label>Firma (HTML)</label>
                        <!-- Tiptap Editor for Signature -->
                        <div style="height: 300px; display: flex; flex-direction: column;">
                            <app-tiptap-editor [content]="formModel.signature"
                                (contentChange)="formModel.signature = $event" placeholder="Escribe tu firma aquí...">
                            </app-tiptap-editor>
                        </div>
                    </div>
                </div>

                <div class="form-footer">
                    <button class="btn btn-secondary" (click)="toggleAdd()">Cancelar</button>
                    <button class="btn btn-primary" (click)="saveAccount()">
                        {{ isEditing ? 'Guardar Cambios' : 'Crear Cuenta' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>