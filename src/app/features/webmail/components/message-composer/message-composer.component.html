<div class="composer-container" [class.drag-over]="isDragOver" (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">

    <div class="composer-header">
        <h2>Mensaje Nuevo</h2>
        <div class="window-actions">
            <button class="btn-icon" (click)="minimize.emit()" title="Minimizar"><i class="fas fa-minus"></i></button>
            <button class="btn-icon" (click)="maximize.emit()" title="Maximizar"><i class="fas fa-expand"></i></button>
            <button class="btn-icon close" (click)="close.emit()" title="Cerrar"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <div class="composer-form">
        <!-- To Field -->
        <div class="form-group to-field">
            <span class="label">Para</span>
            <app-chip-autocomplete [allItems]="searchResults" [loading]="searchLoading" [(selectedItems)]="toRecipients"
                (search)="onSearch($event)" class="flex-1" placeholder="Destinatarios..."></app-chip-autocomplete>
            <div class="cc-bcc-toggle">
                <span (click)="showCc = !showCc" [class.active]="showCc">Cc</span>
                <span (click)="showBcc = !showBcc" [class.active]="showBcc">Cco</span>
            </div>
        </div>

        <!-- Subject Field -->
        <div class="form-group">
            <input type="text" [(ngModel)]="subject" placeholder="Asunto" class="clean-input">
        </div>

        <!-- Editor -->
        <div class="form-group editor">
            <app-tiptap-editor [(content)]="body" placeholder="Escribe tu mensaje aquí..."></app-tiptap-editor>
        </div>

        <!-- Attachments List -->
        <div class="attachments-list" *ngIf="attachments.length > 0">
            <div class="attachment-item" *ngFor="let att of attachments; let i = index">
                <div class="att-icon">
                    <i class="fas fa-file-pdf" *ngIf="att.file.type.includes('pdf')"></i>
                    <i class="fas fa-file-image" *ngIf="att.file.type.includes('image')"></i>
                    <i class="fas fa-file"
                        *ngIf="!att.file.type.includes('pdf') && !att.file.type.includes('image')"></i>
                </div>
                <div class="att-info">
                    <span class="att-name">{{ att.file.name }}</span>
                    <span class="att-size">{{ att.file.size | number }} bytes</span>
                </div>
                <button class="btn-icon remove" (click)="removeAttachment(i)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer Actions -->
    <div class="composer-footer">
        <div class="primary-actions">
            <div class="send-group">
                <button class="btn-send" (click)="send()">
                    Enviar
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button class="btn-schedule">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>

            <div class="formatting-actions">
                <!-- Attachment Button -->
                <input type="file" #fileInput multiple (change)="onFileSelected($event)" style="display: none;">
                <button class="btn-icon" (click)="fileInput.click()" title="Adjuntar archivos">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="btn-icon"><i class="fas fa-link"></i></button>
                <button class="btn-icon"><i class="fas fa-smile"></i></button>
                <button class="btn-icon"><i class="fab fa-google-drive"></i></button>
                <button class="btn-icon"><i class="fas fa-image"></i></button>
                <button class="btn-icon"><i class="fas fa-lock"></i></button>
            </div>
        </div>

        <div class="secondary-actions">
            <button class="btn-icon" (click)="saveDraft()"><i class="fas fa-trash"></i></button>
        </div>
    </div>

    <!-- Drag Overlay -->
    <div class="drag-overlay" *ngIf="isDragOver">
        <div class="drag-message">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>Suelta los archivos aquí para adjuntarlos</span>
        </div>
    </div>
</div>