@tailwind base;
@tailwind components;
@tailwind utilities;

/* Variables CSS para temas dinámicos */
:root {
  /* Viewport height for mobile Safari */
  --vh: 1vh;
  
  /* Colores base */
  /* Colores base */
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --bg-tertiary: #f1f5f9;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --border-color: #e2e8f0;
  --shadow-color: rgba(0, 0, 0, 0.1);
  
  /* Esquema de colores por defecto (orange) */
  --color-primary-50: #fff7ed;
  --color-primary-100: #ffedd5;
  --color-primary-200: #fed7aa;
  --color-primary-300: #fdba74;
  --color-primary-400: #fb923c;
  --color-primary-500: #f97316;
  --color-primary-600: #ea580c;
  --color-primary-700: #c2410c;
  --color-primary-800: #9a3412;
  --color-primary-900: #7c2d12;
}

/* Tema oscuro */
.dark {
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --text-primary: #f8fafc;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --border-color: #475569;
  --shadow-color: rgba(0, 0, 0, 0.3);
}

/* ============================================
   MOBILE: Bloqueo de scroll horizontal
   ============================================ */
@media (max-width: 767px) {
  html, body {
    overflow-x: hidden;
    max-width: 100vw;
  }
  
  /* Prevenir scroll horizontal en todos los contenedores principales */
  .modal, 
  .dialog, 
  .drawer,
  .bottom-sheet,
  [role="dialog"],
  [role="modal"],
  .cdk-overlay-pane,
  .cdk-global-overlay-wrapper {
    overflow-x: hidden;
    max-width: 100vw;
  }
  
  /* Contenedores de página */
  main,
  .main-content,
  .page-content,
  .app-content,
  router-outlet + * {
    overflow-x: hidden;
    max-width: 100%;
  }
}

/* Esquemas de colores alternativos */
.theme-blue {
  --color-primary-50: #eff6ff;
  --color-primary-100: #dbeafe;
  --color-primary-200: #bfdbfe;
  --color-primary-300: #93c5fd;
  --color-primary-400: #60a5fa;
  --color-primary-500: #3b82f6;
  --color-primary-600: #2563eb;
  --color-primary-700: #1d4ed8;
  --color-primary-800: #1e40af;
  --color-primary-900: #1e3a8a;
}

.theme-green {
  --color-primary-50: #f0fdf4;
  --color-primary-100: #dcfce7;
  --color-primary-200: #bbf7d0;
  --color-primary-300: #86efac;
  --color-primary-400: #4ade80;
  --color-primary-500: #22c55e;
  --color-primary-600: #16a34a;
  --color-primary-700: #15803d;
  --color-primary-800: #166534;
  --color-primary-900: #14532d;
}

.theme-purple {
  --color-primary-50: #faf5ff;
  --color-primary-100: #f3e8ff;
  --color-primary-200: #e9d5ff;
  --color-primary-300: #d8b4fe;
  --color-primary-400: #c084fc;
  --color-primary-500: #a855f7;
  --color-primary-600: #9333ea;
  --color-primary-700: #7c3aed;
  --color-primary-800: #6b21a8;
  --color-primary-900: #581c87;
}

.theme-red {
  --color-primary-50: #fef2f2;
  --color-primary-100: #fee2e2;
  --color-primary-200: #fecaca;
  --color-primary-300: #fca5a5;
  --color-primary-400: #f87171;
  --color-primary-500: #ef4444;
  --color-primary-600: #dc2626;
  --color-primary-700: #b91c1c;
  --color-primary-800: #991b1b;
  --color-primary-900: #7f1d1d;
}

/* Clases utilitarias para temas */
.bg-primary { background-color: var(--bg-primary); }
.bg-secondary { background-color: var(--bg-secondary); }
.bg-tertiary { background-color: var(--bg-tertiary); }
.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-muted { color: var(--text-muted); }
.border-theme { border-color: var(--border-color); }

.btn-primary {
  background-color: var(--color-primary-600);
  border-color: var(--color-primary-600);
  color: white;
}

.btn-primary:hover {
  background-color: var(--color-primary-700);
  border-color: var(--color-primary-700);
}

/* Transiciones suaves */
* {
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

/* Clases específicas para el tour */
.tour-button-primary {
  background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
  color: white;
  border: none;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.tour-button-primary:hover {
  background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
  transform: translateY(-1px);
}

.tour-button-secondary {
  background-color: white;
  color: #6b7280;
  border: 1px solid #d1d5db;
  font-weight: 500;
}

.tour-button-secondary:hover {
  background-color: #f9fafb;
  color: #374151;
  border-color: #9ca3af;
}

/* Animación para resaltar elementos */
@keyframes highlight-pulse {
  0%, 100% {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
  }
  50% {
    border-color: #8b5cf6;
    box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.2);
  }
}

.tour-highlight {
  position: relative;
  border: 3px solid #3b82f6;
  border-radius: 8px;
  animation: highlight-pulse 2s infinite;
  z-index: 9999;
}

/* Estilos globales */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Estilos para páginas de autenticación - sin scroll */
.auth-page {
  overflow: hidden !important;
  height: calc(var(--vh, 1vh) * 100) !important;
}

.auth-page html,
.auth-page body {
  overflow: hidden !important;
  height: calc(var(--vh, 1vh) * 100) !important;
  margin: 0;
  padding: 0;
}

/* Global modal overlay rules to ensure it covers everything (including fixed nav/footer) */
.modal-overlay {
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  /* Use dynamic viewport height when available; fallback to previous var(--vh) method */
  height: var(--dvh, calc(var(--vh, 1vh) * 100)) !important;
  z-index: 200000 !important; /* very high */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 !important;
  /* Provide bottom safe-area breathing room so footer buttons aren't hidden by iOS bar */
  padding: clamp(12px, 4vw, 24px) clamp(12px, 4vw, 24px) max(env(safe-area-inset-bottom), clamp(12px, 4vw, 24px)) clamp(12px, 4vw, 24px) !important;
  background: rgba(15, 23, 42, 0.55) !important;
  backdrop-filter: blur(4px);
}

.modal-backdrop {
  position: absolute !important;
  inset: 0 !important;
  width: 100% !important;
  height: calc(var(--vh, 1vh) * 100) !important;
  background-color: rgba(15, 23, 42, 0.55) !important;
  z-index: 200000 !important;
  margin: 0 !important;
  padding: 0 !important;
  backdrop-filter: blur(4px);
}

.modal-dialog {
  position: relative !important;
  z-index: 200001 !important;
  max-height: calc(var(--vh, 1vh) * 85) !important;
  overflow: hidden !important;
  margin: 0 !important;
}

/* Standard modal content layout with sticky footer */
.modal-overlay .modal-content,
.modal-dialog .modal-content,
body .modal-overlay .global-modal,
.global-modal {
  display: flex;
  flex-direction: column;
  /* New dynamic max-height accounts for safe-area bottom; keep previous fallback */
  max-height: calc(var(--dvh, calc(var(--vh, 1vh) * 100)) - max(env(safe-area-inset-bottom), 20px) - 48px);
  width: 100%;
  background: #ffffff;
  border-radius: 12px;
  /* Keep modal content clipped so layout remains stable; dropdowns are positioned relative to their containers */
  overflow: hidden;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
}
/* Keep dropdowns working as before; if you want them above the modal boundaries we should render them into <body> via a portal. */

.modal-overlay .modal-body,
.modal-dialog .modal-body,
.global-modal .modal-body {
  flex: 1 1 auto;
  overflow: auto;
  padding: clamp(16px, 4vw, 24px);
  /* Reduce default bottom padding; append safe-area inset to ensure buttons visible */
  padding-bottom: calc(clamp(64px, 10vw, 88px) + env(safe-area-inset-bottom));
  scrollbar-gutter: stable;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

.modal-overlay .modal-footer,
.modal-dialog .modal-footer,
.global-modal .modal-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.75rem;
  padding: 0.75rem clamp(16px, 4vw, 24px);
  padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));
  border-top: 1px solid rgba(226, 232, 240, 1);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.92), #ffffff);
  position: sticky;
  bottom: 0;
  z-index: 1;
  backdrop-filter: blur(6px);
}

/* Dark mode adjustments for global modal structure */
@media (prefers-color-scheme: dark) {
  .modal-overlay {
    background: rgba(15, 23, 42, 0.55) !important;
  }

  .modal-overlay .modal-content,
  .modal-dialog .modal-content,
  body .modal-overlay .global-modal,
  .global-modal {
    background: #0f172a; /* slate-900 */
    box-shadow: 0 18px 40px rgba(2, 6, 23, 0.55);
  }

  .modal-overlay .modal-footer,
  .modal-dialog .modal-footer,
  .global-modal .modal-footer {
    border-top: 1px solid #334155; /* slate-600 */
    background: linear-gradient(180deg, rgba(15, 23, 42, 0.92), #0f172a);
  }
}

body.modal-open {
  pointer-events: none; /* prevent background clicks */
}

body.modal-open .modal-overlay,
body.modal-open .modal-dialog,
body.modal-open .modal-backdrop {
  pointer-events: auto !important; /* allow interacting with the modal only */
}

/* Ocultar la navegación inferior en móvil mientras haya un modal abierto */
body.modal-open nav.fixed.bottom-0,
body.modal-open app-mobile-bottom-nav nav,
body:has(.modal-overlay) nav.fixed.bottom-0,
body:has(.modal-overlay) app-mobile-bottom-nav nav {
  display: none !important;
}

/* Mejoras para Safari y móviles */
html, body {
  /* Mejorar el scroll en Safari */
  -webkit-overflow-scrolling: touch;
  /* Evitar el zoom en inputs */
  touch-action: manipulation;
}

/* Para PWA en Safari */
@media all and (display-mode: standalone) {
  html, body {
    /* Asegurar que el contenido ocupe toda la altura disponible */
    height: calc(var(--vh, 1vh) * 100);
    overflow-x: hidden;
  }
  
  /* Mejorar el comportamiento del scroll */
  * {
    -webkit-overflow-scrolling: touch;
  }
}

/* Floating Action Button (FAB) - global copy to reuse across app */
.fab-button {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  border: none;
  color: white;
  font-size: 1.25rem;
  cursor: pointer;
  box-shadow: 
    0 8px 32px rgba(59, 130, 246, 0.4),
    0 4px 16px rgba(0, 0, 0, 0.15);
  z-index: 5000;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  animation: fabSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);

  &:hover:not(:disabled) {
    transform: scale(1.1);
    box-shadow: 
      0 12px 48px rgba(59, 130, 246, 0.5),
      0 6px 24px rgba(0, 0, 0, 0.2);
    background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
  }

  &:active:not(:disabled) {
    transform: scale(1.05);
    transition: transform 0.1s;
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: 
      0 4px 16px rgba(59, 130, 246, 0.2),
      0 2px 8px rgba(0, 0, 0, 0.1);
  }

  /* Icon rotation supports both <i> and <svg> inside */
  i, svg {
    transition: transform 0.2s ease;
  }

  &:hover:not(:disabled) i,
  &:hover:not(:disabled) svg {
    transform: rotate(90deg);
  }
}

@keyframes fabSlideIn {
  0% {
    transform: translateY(100px) scale(0.8);
    opacity: 0;
  }
  60% {
    transform: translateY(-8px) scale(1.05);
    opacity: 0.9;
  }
  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

@media (max-width: 768px) {
  .fab-button {
    bottom: 70px;
    right: 8px;
    width: 52px;
    height: 52px;
    font-size: 1.1rem;
    z-index: 5000;
  }
}

/* iOS PWA specific adjustment - Safari tiene un menú inferior que tapa los botones */
body.ios-pwa {
  .fab-button {
    /* En iOS PWA, el menú inferior de Safari ocupa más espacio */
    bottom: 90px !important;
  }
  
  @media (max-width: 768px) {
    .fab-button {
      /* En mobile iOS PWA necesitamos aún más espacio */
      bottom: 100px !important;
    }
  }
  
  /* Ajuste para botones flotantes que usan Tailwind bottom-8 (32px) */
  .fixed.bottom-8 {
    bottom: 90px !important;
  }
  
  @media (max-width: 768px) {
    .fixed.bottom-8 {
      bottom: 100px !important;
    }
  }
}

@media (prefers-color-scheme: dark) {
  .fab-button {
    background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
    &:hover:not(:disabled) {
      background: linear-gradient(135deg, #4338ca 0%, #312e81 100%);
    }
  }
}

@media (prefers-reduced-motion: reduce) {
  .fab-button {
    animation: none;
    transition: opacity 0.3s;
    &:hover:not(:disabled) {
      transform: none;
      i, svg { transform: none; }
    }
    &:active:not(:disabled) { transform: none; }
  }
}

/* Extra small breakpoint for better mobile control */
@media (min-width: 475px) {
  .xs\:inline {
    display: inline;
  }
  .xs\:hidden {
    display: none;
  }
}

/* ============================================
   ESTILOS GLOBALES DE DARK MODE
   ============================================ */

/* Asegurar que dark mode funcione en todos los componentes */
@media (prefers-color-scheme: dark) {
  
  /* Labels de formularios */
  label,
  .form-label {
    color: #f8fafc !important;
  }
  
  /* Inputs, textareas y selects */
  input:not([type="checkbox"]):not([type="radio"]),
  textarea,
  select {
    background-color: #1e293b !important;
    color: #f1f5f9 !important;
    border-color: #475569 !important;
    
    &::placeholder {
      color: #94a3b8 !important;
    }
    
    &:focus {
      border-color: #3b82f6 !important;
      background-color: #1e293b !important;
    }
  }
  
  /* Checkboxes y radios */
  input[type="checkbox"],
  input[type="radio"] {
    border-color: #475569 !important;
    background-color: #1e293b !important;
    
    &:checked {
      background-color: #3b82f6 !important;
      border-color: #3b82f6 !important;
    }
  }
  
  /* Opciones de select - forzar estilos en navegadores que lo soporten */
  select option,
  option {
    background-color: #1e293b !important;
    color: #f1f5f9 !important;
  }
  
  /* Select con color scheme oscuro para mejorar dropdowns nativos */
  select {
    color-scheme: dark;
  }
  
  /* Mensajes de error */
  .error-message {
    color: #fca5a5 !important;
  }
  
  /* Texto general */
  // small,
  // .text-xs,
  // .text-sm {
  //   &:not(.text-blue-500):not(.text-red-500):not(.text-green-500):not(.text-yellow-500):not(.text-purple-500) {
  //     color: #cbd5e1 !important;
  //   }
  // }
  
  /* Modal y acordeones */
  .modal-content {
    background-color: #0f172a !important;
  }
  
  .modal-header {
    background-color: #0f172a !important;
    border-bottom-color: #334155 !important;
  }
  
  .modal-actions {
    background-color: #0f172a !important;
    border-top-color: #334155 !important;
  }
  
  .accordion-header {
    background-color: #1e293b !important;
    
    &:hover {
      background-color: rgba(51, 65, 85, 0.5) !important;
    }
  }
  
  .accordion-title {
    color: #f1f5f9 !important;
  }
  
  /* Botones secundarios */
  // button:not(.btn-primary):not(.bg-blue-600):not(.bg-green-600):not(.bg-red-600) {
  //   &:not(.fab-button) {
  //     color: #cbd5e12f;
      
  //     &:hover {
  //       background-color: #334155 !important;
  //     }
  //   }
  // }
}
